generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum VehicleType {
  CAR
  MOTORCYCLE
  BUS
  TRUCK
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  passwordHash String
  name      String?
  lastName  String?
  phone     String?
  photoUrl  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  parkings  Parking[] @relation("ParkingOwner")
  bookings  Booking[] @relation("BookingDriver")
  reviews   Review[]
  vehicles  Vehicle[]
}

model Vehicle {
  id        String      @id @default(uuid())
  brand     String
  model     String
  plate     String
  type      VehicleType
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relaciones
  ownerId   String
  owner     User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  bookings  Booking[]

  @@unique([plate, ownerId]) // Evitar duplicados por usuario
}

model Parking {
  id           String   @id @default(uuid())
  title        String
  address      String
  pricePerHour Float
  totalSpaces  Int
  lat          Float
  lng          Float
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relaciones
  ownerId      String
  owner        User      @relation("ParkingOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  bookings     Booking[]
  reviews      Review[]
}

model Booking {
  id         String        @id @default(uuid())
  startTime  DateTime
  endTime    DateTime
  totalPrice Float?
  status     BookingStatus @default(CONFIRMED)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  // Relaciones
  driverId   String
  driver     User    @relation("BookingDriver", fields: [driverId], references: [id])
  
  parkingId  String
  parking    Parking @relation(fields: [parkingId], references: [id])
  
  vehicleId  String
  vehicle    Vehicle @relation(fields: [vehicleId], references: [id])
}

model Review {
  id        String   @id @default(uuid())
  rating    Int      // 1-5
  comment   String
  createdAt DateTime @default(now())

  // Relaciones
  driverId  String
  driver    User    @relation(fields: [driverId], references: [id])
  
  parkingId String
  parking   Parking @relation(fields: [parkingId], references: [id], onDelete: Cascade)
}
